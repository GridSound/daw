"use strict";function walContext(){this.ctx=new window.AudioContext,this.destination=this.ctx.destination,this.filters=this.createFilters(),this.buffers=[],this.compositions=[],this.nbPlaying=0,this.filters.connect(this.destination),this.nodeIn=this.filters.nodeIn,delete this.filters.connect}!function(){function e(e){var t=keyboardRouter.defaultOptions,n=e.fn||t.fn,i={name:e.name,when:(e.when||t.when).toUpperCase(),preventDefault:void 0!==e.preventDefault?e.preventDefault:t.preventDefault,alt:!1,ctrl:!1,shift:!1,keys:[]};return i.fn=n.bind(e.thisArg||t.thisArg,e),e.keys.forEach(function(e){e=e.toUpperCase(),"ALT"===e?i.alt=!0:"CTRL"===e?i.ctrl=!0:"SHIFT"===e?i.shift=!0:i.keys.push(1===e.length?e.charCodeAt(0):keyboardRouter.keys[e])}),i}function t(){for(;o.length;){var e=o.pop();e.active&&(delete e.active,e.fn({type:"keyup"}))}}function n(e){var t=e.keyCode;s[t]||(s[t]=!0,a.some(function(n){return n.active||e.altKey!==n.alt||e.ctrlKey!==n.ctrl||e.shiftKey!==n.shift||n.keys.length&&t!==n.keys[0]||(n.fn(e),n.when.indexOf("UP")>-1&&(n.active=!0,o.push(n)),n.preventDefault===!1)?void 0:(e.preventDefault(),!0)}))}function i(e){var t,n,i,a=e.keyCode,r=o.length;if(s[a]=!1,r){for(i=[],t=r-1;t>=0;--t)n=o[t],n.active&&(n.alt&&!e.altKey||n.ctrl&&!e.ctrlKey||n.shift&&!e.shiftKey||n.keys.length||a===n.keys[0])&&i.push(t);i.forEach(function(t){n=o[t],delete n.active,n.fn(e),o.splice(t,1)})}}var s=[],a=[],o=[];window.keyboardRouter=function(){for(var s=0,o=arguments.length;o>s;)a.push(e(arguments[s++]));document.body.addEventListener("keydown",n),document.body.addEventListener("keyup",i),window.addEventListener("blur",t)},keyboardRouter.defaultOptions={when:"down",fn:function(){},preventDefault:!0},keyboardRouter.keys={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPSLOCK:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,OS:91,CONTEXTMENU:93,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145}}(),function(){function e(e,t,n){return n||(n=t,t=document),e?i(t.querySelectorAll(n)):t.querySelector(n)}function t(e,t){var n,i=1,s=t.classList;for(aLen=arguments.length,lastArg=arguments[aLen-1],"boolean"==typeof lastArg&&(e=lastArg,--aLen);n=arguments[++i];)s.toggle(n,e)}function n(e,t){if(e){if(void 0===e.length)return t(e,0);for(var n,i,s=0;i=e[s];++s)if(void 0!==(n=t(i,s)))return n}}function i(e){return e.every=o,e.forEach=r,e.some=l,e}var s=window.wisdom={},a=[],o=a.every,r=a.forEach,l=a.some;s.querySelector=s.qS=e.bind(null,!1),s.querySelectorAll=s.qSA=e.bind(null,!0),s.createElement=s.cE=function(e){if("<"!==e[0])return document.createElement(e);var t=document.createElement("div");return t.innerHTML=e,i(t.children)},s.css=function(e,t,i){var s=arguments.length;return n(e,s>2?function(e){e.style[t]=i}:function(e){var n=getComputedStyle(e);return s>1?n[t]:n})},s.cLc=function(e,t){return e.classList.contains(t)},s.cLa=t.bind(null,!0),s.cLr=t.bind(null,!1),s.cLt=t.bind(null,void 0),s.classList={contains:s.cLc,add:s.cLa,remove:s.cLr,toggle:s.cLt}}(),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function i(){var e=new r.HandlebarsEnvironment;return m.extend(e,r),e.SafeString=u["default"],e.Exception=d["default"],e.Utils=m,e.escapeExpression=m.escapeExpression,e.VM=h,e.template=function(t){return h.template(t,e)},e}var s=n(1)["default"],a=n(2)["default"];t.__esModule=!0;var o=n(3),r=s(o),l=n(17),u=a(l),c=n(5),d=a(c),f=n(4),m=s(f),p=n(18),h=s(p),g=n(19),v=a(g),w=i();w.create=i,v["default"](w),w["default"]=w,t["default"]=w,e.exports=t["default"]},function(e,t){t["default"]=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t},t.__esModule=!0},function(e,t){t["default"]=function(e){return e&&e.__esModule?e:{"default":e}},t.__esModule=!0},function(e,t,n){function i(e,t,n){this.helpers=e||{},this.partials=t||{},this.decorators=n||{},l.registerDefaultHelpers(this),u.registerDefaultDecorators(this)}var s=n(2)["default"];t.__esModule=!0,t.HandlebarsEnvironment=i;var a=n(4),o=n(5),r=s(o),l=n(6),u=n(14),c=n(16),d=s(c),f="4.0.5";t.VERSION=f;var m=7;t.COMPILER_REVISION=m;var p={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0"};t.REVISION_CHANGES=p;var h="[object Object]";i.prototype={constructor:i,logger:d["default"],log:d["default"].log,registerHelper:function(e,t){if(a.toString.call(e)===h){if(t)throw new r["default"]("Arg not supported with multiple helpers");a.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if(a.toString.call(e)===h)a.extend(this.partials,e);else{if("undefined"==typeof t)throw new r["default"]('Attempting to register a partial called "'+e+'" as undefined');this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if(a.toString.call(e)===h){if(t)throw new r["default"]("Arg not supported with multiple decorators");a.extend(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};var g=d["default"].log;t.log=g,t.createFrame=a.createFrame,t.logger=d["default"]},function(e,t){function n(e){return c[e]}function i(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}function s(e,t){for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function a(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return f.test(e)?e.replace(d,n):e}function o(e){return e||0===e?h(e)&&0===e.length?!0:!1:!0}function r(e){var t=i({},e);return t._parent=e,t}function l(e,t){return e.path=t,e}function u(e,t){return(e?e+".":"")+t}t.__esModule=!0,t.extend=i,t.indexOf=s,t.escapeExpression=a,t.isEmpty=o,t.createFrame=r,t.blockParams=l,t.appendContextPath=u;var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},d=/[&<>"'`=]/g,f=/[&<>"'`=]/,m=Object.prototype.toString;t.toString=m;var p=function(e){return"function"==typeof e};p(/x/)&&(t.isFunction=p=function(e){return"function"==typeof e&&"[object Function]"===m.call(e)}),t.isFunction=p;var h=Array.isArray||function(e){return e&&"object"==typeof e?"[object Array]"===m.call(e):!1};t.isArray=h},function(e,t){function n(e,t){var s=t&&t.loc,a=void 0,o=void 0;s&&(a=s.start.line,o=s.start.column,e+=" - "+a+":"+o);for(var r=Error.prototype.constructor.call(this,e),l=0;l<i.length;l++)this[i[l]]=r[i[l]];Error.captureStackTrace&&Error.captureStackTrace(this,n),s&&(this.lineNumber=a,this.column=o)}t.__esModule=!0;var i=["description","fileName","lineNumber","message","name","number","stack"];n.prototype=new Error,t["default"]=n,e.exports=t["default"]},function(e,t,n){function i(e){o["default"](e),l["default"](e),c["default"](e),f["default"](e),p["default"](e),g["default"](e),w["default"](e)}var s=n(2)["default"];t.__esModule=!0,t.registerDefaultHelpers=i;var a=n(7),o=s(a),r=n(8),l=s(r),u=n(9),c=s(u),d=n(10),f=s(d),m=n(11),p=s(m),h=n(12),g=s(h),v=n(13),w=s(v)},function(e,t,n){t.__esModule=!0;var i=n(4);t["default"]=function(e){e.registerHelper("blockHelperMissing",function(t,n){var s=n.inverse,a=n.fn;if(t===!0)return a(this);if(t===!1||null==t)return s(this);if(i.isArray(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):s(this);if(n.data&&n.ids){var o=i.createFrame(n.data);o.contextPath=i.appendContextPath(n.data.contextPath,n.name),n={data:o}}return a(t,n)})},e.exports=t["default"]},function(e,t,n){var i=n(2)["default"];t.__esModule=!0;var s=n(4),a=n(5),o=i(a);t["default"]=function(e){e.registerHelper("each",function(e,t){function n(t,n,a){u&&(u.key=t,u.index=n,u.first=0===n,u.last=!!a,c&&(u.contextPath=c+t)),l+=i(e[t],{data:u,blockParams:s.blockParams([e[t],t],[c+t,null])})}if(!t)throw new o["default"]("Must pass iterator to #each");var i=t.fn,a=t.inverse,r=0,l="",u=void 0,c=void 0;if(t.data&&t.ids&&(c=s.appendContextPath(t.data.contextPath,t.ids[0])+"."),s.isFunction(e)&&(e=e.call(this)),t.data&&(u=s.createFrame(t.data)),e&&"object"==typeof e)if(s.isArray(e))for(var d=e.length;d>r;r++)r in e&&n(r,r,r===e.length-1);else{var f=void 0;for(var m in e)e.hasOwnProperty(m)&&(void 0!==f&&n(f,r-1),f=m,r++);void 0!==f&&n(f,r-1,!0)}return 0===r&&(l=a(this)),l})},e.exports=t["default"]},function(e,t,n){var i=n(2)["default"];t.__esModule=!0;var s=n(5),a=i(s);t["default"]=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new a["default"]('Missing helper: "'+arguments[arguments.length-1].name+'"')})},e.exports=t["default"]},function(e,t,n){t.__esModule=!0;var i=n(4);t["default"]=function(e){e.registerHelper("if",function(e,t){return i.isFunction(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||i.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},e.exports=t["default"]},function(e,t){t.__esModule=!0,t["default"]=function(e){e.registerHelper("log",function(){for(var t=[void 0],n=arguments[arguments.length-1],i=0;i<arguments.length-1;i++)t.push(arguments[i]);var s=1;null!=n.hash.level?s=n.hash.level:n.data&&null!=n.data.level&&(s=n.data.level),t[0]=s,e.log.apply(e,t)})},e.exports=t["default"]},function(e,t){t.__esModule=!0,t["default"]=function(e){e.registerHelper("lookup",function(e,t){return e&&e[t]})},e.exports=t["default"]},function(e,t,n){t.__esModule=!0;var i=n(4);t["default"]=function(e){e.registerHelper("with",function(e,t){i.isFunction(e)&&(e=e.call(this));var n=t.fn;if(i.isEmpty(e))return t.inverse(this);var s=t.data;return t.data&&t.ids&&(s=i.createFrame(t.data),s.contextPath=i.appendContextPath(t.data.contextPath,t.ids[0])),n(e,{data:s,blockParams:i.blockParams([e],[s&&s.contextPath])})})},e.exports=t["default"]},function(e,t,n){function i(e){o["default"](e)}var s=n(2)["default"];t.__esModule=!0,t.registerDefaultDecorators=i;var a=n(15),o=s(a)},function(e,t,n){t.__esModule=!0;var i=n(4);t["default"]=function(e){e.registerDecorator("inline",function(e,t,n,s){var a=e;return t.partials||(t.partials={},a=function(s,a){var o=n.partials;n.partials=i.extend({},o,t.partials);var r=e(s,a);return n.partials=o,r}),t.partials[s.args[0]]=s.fn,a})},e.exports=t["default"]},function(e,t,n){t.__esModule=!0;var i=n(4),s={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){var t=i.indexOf(s.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e){if(e=s.lookupLevel(e),"undefined"!=typeof console&&s.lookupLevel(s.level)<=e){var t=s.methodMap[e];console[t]||(t="log");for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;n>a;a++)i[a-1]=arguments[a];console[t].apply(console,i)}}};t["default"]=s,e.exports=t["default"]},function(e,t){function n(e){this.string=e}t.__esModule=!0,n.prototype.toString=n.prototype.toHTML=function(){return""+this.string},t["default"]=n,e.exports=t["default"]},function(e,t,n){function i(e){var t=e&&e[0]||1,n=v.COMPILER_REVISION;if(t!==n){if(n>t){var i=v.REVISION_CHANGES[n],s=v.REVISION_CHANGES[t];throw new g["default"]("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+s+").")}throw new g["default"]("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function s(e,t){function n(n,i,s){s.hash&&(i=p.extend({},i,s.hash),s.ids&&(s.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,i,s);var a=t.VM.invokePartial.call(this,n,i,s);if(null==a&&t.compile&&(s.partials[s.name]=t.compile(n,e.compilerOptions,t),a=s.partials[s.name](i,s)),null!=a){if(s.indent){for(var o=a.split("\n"),r=0,l=o.length;l>r&&(o[r]||r+1!==l);r++)o[r]=s.indent+o[r];a=o.join("\n")}return a}throw new g["default"]("The partial "+s.name+" could not be compiled when running in runtime-only mode")}function i(t){function n(t){return""+e.main(s,t,s.helpers,s.partials,o,l,r)}var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],o=a.data;i._setup(a),!a.partial&&e.useData&&(o=u(t,o));var r=void 0,l=e.useBlockParams?[]:void 0;return e.useDepths&&(r=a.depths?t!==a.depths[0]?[t].concat(a.depths):a.depths:[t]),(n=c(e.main,n,s,a.depths||[],o,l))(t,a)}if(!t)throw new g["default"]("No environment passed to template");if(!e||!e.main)throw new g["default"]("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);var s={strict:function(e,t){if(!(t in e))throw new g["default"]('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;n>i;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:p.escapeExpression,invokePartial:n,fn:function(t){var n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,i,s){var o=this.programs[e],r=this.fn(e);return t||s||i||n?o=a(this,e,r,t,n,i,s):o||(o=this.programs[e]=a(this,e,r)),o},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=p.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};return i.isTop=!0,i._setup=function(n){n.partial?(s.helpers=n.helpers,s.partials=n.partials,s.decorators=n.decorators):(s.helpers=s.merge(n.helpers,t.helpers),e.usePartial&&(s.partials=s.merge(n.partials,t.partials)),(e.usePartial||e.useDecorators)&&(s.decorators=s.merge(n.decorators,t.decorators)))},i._child=function(t,n,i,o){if(e.useBlockParams&&!i)throw new g["default"]("must pass block params");if(e.useDepths&&!o)throw new g["default"]("must pass parent depths");return a(s,t,e[t],n,0,i,o)},i}function a(e,t,n,i,s,a,o){function r(t){var s=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=o;return o&&t!==o[0]&&(r=[t].concat(o)),n(e,t,e.helpers,e.partials,s.data||i,a&&[s.blockParams].concat(a),r)}return r=c(n,r,e,o,i,a),r.program=t,r.depth=o?o.length:0,r.blockParams=s||0,r}function o(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e}function r(e,t,n){n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath);var i=void 0;if(n.fn&&n.fn!==l&&(n.data=v.createFrame(n.data),i=n.data["partial-block"]=n.fn,i.partials&&(n.partials=p.extend({},n.partials,i.partials))),void 0===e&&i&&(e=i),void 0===e)throw new g["default"]("The partial "+n.name+" could not be found");return e instanceof Function?e(t,n):void 0}function l(){return""}function u(e,t){return t&&"root"in t||(t=t?v.createFrame(t):{},t.root=e),t}function c(e,t,n,i,s,a){if(e.decorator){var o={};t=e.decorator(t,o,n,i&&i[0],s,a,i),p.extend(t,o)}return t}var d=n(1)["default"],f=n(2)["default"];t.__esModule=!0,t.checkRevision=i,t.template=s,t.wrapProgram=a,t.resolvePartial=o,t.invokePartial=r,t.noop=l;var m=n(4),p=d(m),h=n(5),g=f(h),v=n(3)},function(e,t){(function(n){t.__esModule=!0,t["default"]=function(e){var t="undefined"!=typeof n?n:window,i=t.Handlebars;e.noConflict=function(){return t.Handlebars===e&&(t.Handlebars=i),e}},e.exports=t["default"]}).call(t,function(){return this}())}])}),function(){var e=Handlebars.template,t=Handlebars.templates=Handlebars.templates||{};t._app=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return(null!=(a=e.invokePartial(i.visual,t,{name:"visual",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(i.menu,t,{name:"menu",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(i.panel,t,{name:"panel",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(i.grid,t,{name:"grid",data:s,helpers:n,partials:i,decorators:e.decorators}))?a:"")},usePartial:!0,useData:!0}),t.clock=e({compiler:[7,">= 4.0.0"],main:function(){return'<div id="clock">\n	<span id="clockMin"></span>\n	<span id="clockSec"></span>\n	<span id="clockMs"></span>\n	<a id="clockUnits" href="#">\n		<span class="s">sec</span>\n		<span class="b">beat</span>\n	</a>\n</div>\n'},useData:!0}),t.file=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<a class="sample" draggable="true">\n	<div class="waveformWrapper">\n		<svg class="waveform" preserveAspectRatio="none"><path/></svg>\n	</div>\n	<span class="name text-overflow">\n		<i class="icon fw"></i>\n		<span>'+e.escapeExpression((a=null!=(a=n.name||(null!=t?t.name:t))?a:n.helperMissing,"function"==typeof a?a.call(null!=t?t:{},{name:"name",hash:{},data:s}):a))+"</span>\n	</span>\n</a>\n"},useData:!0}),t.grid=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<div id="grid">\n	<div id="gridEm">\n		<div id="gridHeader">\n'+(null!=(a=e.invokePartial(i.timeline,t,{name:"timeline",data:s,indent:"			",helpers:n,partials:i,decorators:e.decorators}))?a:"")+'		</div>\n		<div id="tracks">\n			<div id="gridCols">\n				<div id="tracksNames" class="colA">\n					<div class="extend" data-mousemove-fn="trackNames"></div>\n				</div>\n				<div id="gridColB">\n					<div id="tracksBg"></div>\n					<div id="tracksLines">\n						<div id="currentTimeCursor"></div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'},usePartial:!0,useData:!0}),t.historyAction=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a,o,r=null!=t?t:{},l=n.helperMissing,u="function",c=e.escapeExpression;return'<a class="task">\n	<i class="icon fw circle"></i\n	><i class="icon fw tool tool-'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:l,typeof o===u?o.call(r,{name:"name",hash:{},data:s}):o))+'"></i\n	><b class="title">'+c((o=null!=(o=n.name||(null!=t?t.name:t))?o:l,typeof o===u?o.call(r,{name:"name",hash:{},data:s}):o))+'</b\n	><span class="text">'+(null!=(o=null!=(o=n.desc||(null!=t?t.desc:t))?o:l,a=typeof o===u?o.call(r,{name:"desc",hash:{},data:s}):o)?a:"")+"</span>\n</a>\n"},useData:!0}),t.menu=e({compiler:[7,">= 4.0.0"],main:function(){return'<div id="menu">\n	<a id="btnPlay" class="btn border icon play" title="Play/pause (press Space, hold Ctrl for pause)"></a>\n	<a id="btnStop" class="btn border icon stop" title="Stop (press Space)"></a>\n	<div id="bpm" class="border" title="Beats per minute (Scroll to change)">\n		<span class="text">\n			<a class="bpmLink">\n				<i class="icon"></i>\n				<span id="bpmInt"></span>\n				<span id="bpmDec"></span>\n			</a>\n			<div id="bpmList">\n				<a>80</a><a>90</a><a>100</a>\n				<a>110</a><a>120</a><a>130</a>\n				<a>140</a><a>150</a><a>160</a>\n			</div>\n			<span class="unit">bpm</span>\n		</span>\n	</div>\n	<a data-edit="save"     id="btnSave"   class="btn icon fw save" title="Save"></a>\n	<a data-option="magnet" id="btnMagnet" class="btn icon fw magnet" title="Toggle magnetism (press G)"></a>\n	<div class="sep"></div>\n	<a data-tool="select" class="btn icon fw tool-select" title="Select (hold Shift or press V)"></a>\n	<a data-tool="paint"  class="btn icon fw tool-paint" title="Paint (press B)"></a>\n	<a data-tool="delete" class="btn icon fw tool-delete" title="Delete (press D)"></a>\n	<a data-tool="gain"   class="btn icon fw tool-gain" title="Gain (press G)"></a>\n	<a data-tool="slip"   class="btn icon fw tool-slip" title="Slip (press S)"></a>\n	<a data-tool="cut"    class="btn icon fw tool-cut" title="Cut (press C)"></a>\n	<a data-tool="hand"   class="btn icon fw tool-hand" title="Hand (hold Alt or press H)"></a>\n	<a data-tool="zoom"   class="btn icon fw tool-zoom last" title="Zoom (hold Ctrl or press Z)"></a>\n	<div class="flex1"></div>\n	<a href=".." target="_blank" class="icon about" title="About"></a>\n</div>\n'},useData:!0}),t["panel-files"]=e({compiler:[7,">= 4.0.0"],main:function(){return'<section id="files">\n	<input id="filesInput" type="file"/>\n	<nav id="filesFilters">\n		<a href="#" class="used">Used</a>\n		<a href="#" class="loaded">Loaded</a>\n		<a href="#" class="unloaded">Unloaded</a>\n	</nav>\n	<div id="filesList" class="list"></div>\n	<div class="placeholder">\n		<i class="icon file-audio"></i><br/>\n		<b>Drop audio files here</b>\n	</div>\n</section>\n'},useData:!0}),t["panel-history"]=e({compiler:[7,">= 4.0.0"],main:function(){return'<section id="history">\n	<nav>\n		<span class="title">History</span>\n		<a id="btnUndo" class="btn icon fw undo" title="Undo (Ctrl + Z)"></a>\n		<a id="btnRedo" class="btn icon fw redo" title="Redo (Ctrl + Shift + Z)"></a>\n	</nav>\n	<div id="historyList" class="list"></div>\n</section>\n'},useData:!0}),t.panel=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<div id="panel">\n	<div class="extend" data-mousemove-fn="panel"></div>\n'+(null!=(a=e.invokePartial(i["panel-history"],t,{name:"panel-history",data:s,indent:"	",helpers:n,partials:i,decorators:e.decorators}))?a:"")+(null!=(a=e.invokePartial(i["panel-files"],t,{name:"panel-files",data:s,indent:"	",helpers:n,partials:i,decorators:e.decorators}))?a:"")+"</div>\n"},usePartial:!0,useData:!0}),t.sample=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<div class="sample">\n	<div class="waveformWrapper">\n		<svg class="waveform" preserveAspectRatio="none"><path/></svg>\n	</div>\n	<span class="name text-overflow">'+e.escapeExpression((a=null!=(a=n.name||(null!=t?t.name:t))?a:n.helperMissing,"function"==typeof a?a.call(null!=t?t:{},{name:"name",hash:{},data:s}):a))+'</span>\n	<div class="crop start"></div>\n	<div class="crop end"></div>\n</div>\n'},useData:!0}),t.timeline=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<div id="timeline">\n	<span id="currentTimeArrow" class="icon caret-down"></span>\n'+(null!=(a=e.invokePartial(i.timelineLoop,t,{name:"timelineLoop",data:s,indent:"	",helpers:n,partials:i,decorators:e.decorators}))?a:"")+'	<div id="timelineBeats"></div>\n</div>\n'},usePartial:!0,useData:!0}),t.timelineBeat=e({compiler:[7,">= 4.0.0"],main:function(){return'<span class="timelineBeat">\n	<span></span>\n</span>\n'},useData:!0}),t.timelineLoop=e({compiler:[7,">= 4.0.0"],main:function(){return'<div id="timelineLoop">\n	<div class="time a"></div>\n	<div class="time b"></div>\n</div>\n'},useData:!0}),t.visual=e({compiler:[7,">= 4.0.0"],main:function(e,t,n,i,s){var a;return'<div id="visual">\n	<canvas id="visualCanvas"></canvas>\n	<div class="columns">\n		<div class="cell-btn"><a id="btnHistory" class="btn icon fw history" title="History (undo/redo)"></a></div>\n		<div class="cell-btn"><a id="btnFiles" class="btn icon fw files" title="Audio files"></a></div>\n		<div class="cell-clock">\n'+(null!=(a=e.invokePartial(i.clock,t,{name:"clock",data:s,indent:"			",helpers:n,partials:i,decorators:e.decorators}))?a:"")+"		</div>\n	</div>\n</div>\n"},usePartial:!0,useData:!0})}(),window.AudioContext=window.AudioContext||window.webkitAudioContext,walContext.prototype={gain:function(e){return arguments.length?(this.filter.gain(e),this):this.filter.gain()},createSample:function(){return new walContext.Sample(this)},createBuffer:function(e){var t=this;return new Promise(function(n,i){new walContext.Buffer(t,e,n,i)}).then(function(e){return t.buffers.push(e),e})},createFilters:function(){return new walContext.Filters(this)},createComposition:function(){var e=new walContext.Composition(this);return this.compositions.push(e),e}},function(){function e(e){this.samples.indexOf(e)<0&&(this.samples.push(e),e.composition=this,this.update(e,"ad"))}function t(e){var t=this.samples.indexOf(e);t>-1&&(e.composition=null,this.samples.splice(t,1),this.update(e,"rm"))}function n(e){clearTimeout(e.playTimeoutId),e.samples.forEach(function(e){e.stop()})}function i(e){var t=e.currentTime();e.samples.forEach(function(e){u(e)>t&&e.load()})}function s(e){var t=e.currentTime();e.samples.forEach(function(e){u(e)>t&&l(e,t)}),o(e)}function a(e){var t=e.samples[e.samples.length-1]||null,n=t?u(t):0;e.lastSample=t,Math.abs(e.duration-n)>.001&&(e.duration=n,o(e))}function o(e){var t=e.duration-e.currentTime();clearTimeout(e.playTimeoutId),0>=t?e.onended():e.playTimeoutId=setTimeout(e.onended.bind(e),1e3*t)}function r(e,t,n){var i=e.currentTime();u(t)>i&&"rm"!==n&&(t.load(),l(t,i))}function l(e,t){var n=e.when-t;e.start(n,n>0?e.offset:e.offset-n,n>0?e.duration:e.duration+n)}function u(e){return e.when+e.duration}walContext.Composition=function(e){this.wCtx=e,this.samples=[],this.lastSample=null,this.isPlaying=this.isPaused=!1,this.duration=this._startedTime=this._currentTime=0,this.fnOnended=this.fnOnpaused=function(){}},walContext.Composition.prototype={add:function(t){return t.forEach?t.forEach(e,this):e.call(this,t),this},remove:function(e){return e.forEach?e.forEach(t,this):t.call(this,e),this},update:function(e,t){var n,i=this;return"rm"!==t&&this.samples.sort(function(e,t){return e.when<t.when?-1:e.when>t.when?1:0}),a(this),this.isPlaying&&(e.started?(n=e._onendedFn,e.onended(function(){r(i,e,t),e.onended(n),n()}),e.stop()):r(this,e,t)),this},currentTime:function(e){return arguments.length?(this.isPlaying&&n(this),this._currentTime=Math.max(0,Math.min(e,this.duration)),this.isPlaying&&(this._startedTime=this.wCtx.ctx.currentTime,i(this),s(this)),this):this._currentTime+(this.isPlaying&&this.wCtx.ctx.currentTime-this._startedTime)},play:function(){return this.isPlaying||(this.isPlaying=!0,this.isPaused=!1,this._startedTime=this.wCtx.ctx.currentTime,i(this),s(this)),this},stop:function(){return(this.isPlaying||this.isPaused)&&(n(this),this.onended()),this},pause:function(){return this.isPlaying&&(this.isPlaying=!1,this.isPaused=!0,this._currentTime+=this.wCtx.ctx.currentTime-this._startedTime,this._startedTime=0,n(this),this.fnOnpaused()),this},onended:function(e){return"function"==typeof e?this.fnOnended=e:(this.isPlaying=this.isPaused=!1,this._startedTime=this._currentTime=0,this.fnOnended()),this}}}(),function(){walContext.Buffer=function(e,t,n,i){function s(e){a.wCtx.ctx.decodeAudioData(e,function(e){a.buffer=e,a.isReady=!0,n(a)},i)}var a=this,o=new FileReader;this.wCtx=e,this.isReady=!1,t.name?(o.addEventListener("loadend",function(){s(o.result)}),o.readAsArrayBuffer(t)):s(t)},walContext.Buffer.prototype={getPeaks:function(e,t,n,i){n=n||0,i=void 0===i?this.buffer.duration-n:Math.min(i,this.buffer.duration-n);for(var s,a,o,r=0,l=new Array(t),u=this.buffer.getChannelData(e),c=i*this.buffer.sampleRate,d=n*this.buffer.sampleRate,f=c/t,m=~~Math.max(1,f/10);t>r;++r){for(s=d+r*f,a=s+f,o=0;a>s;s+=m)o=Math.max(o,Math.abs(u[~~s]));l[r]=o}return l}}}(),function(){function e(e,t,n){e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3]}function t(t,n,i,s){var a,o,r,l,u=n.data,c=n.width,d=n.height,f=d/2,m=t.getPeaks(0,c),p=t.buffer.numberOfChannels>1?t.getPeaks(1,c):m;if(s){for(a=0;a<u.length;a+=4)e(u,a,i);i=[0,0,0,0]}for(a=0;c>a;++a){for(r=~~(f*(1-m[a])),l=~~(f*(1+p[a])),o=r;l>=o;++o)e(u,4*(o*c+a),i);e(u,4*(f*c+a),i)}return n}walContext.Buffer.prototype.waveformSVG=function(e,t,n,i,s,a){var o,r=n/2-.5,l=n/2+.5,u="M0 "+r,c=e?e.firstChild:document.createElement("path"),d=this.getPeaks(0,t,i,s),f=this.buffer.numberOfChannels>1?this.getPeaks(1,t,i,s):d;for(a=void 0!==a?a:1,e||(e=document.createElement("svg"),e.appendChild(c)),o=0;t>o;++o)u+=" L"+o+" "+(r-d[o]*r*a);for(o=t-1;o>=0;--o)u+=" L"+o+" "+(l+f[o]*r*a);return c.setAttribute("d",u),e.setAttribute("viewBox","0 0 "+t+" "+n),e},walContext.Buffer.prototype.drawWaveform=function(e,n){return t(this,e,n)},walContext.Buffer.prototype.drawInvertedWaveform=function(e,n){return t(this,e,n,!0)}}(),walContext.Filters=function(e){this.wCtx=e,this.nodes=[],this.nodeIn=e.ctx.createGain(),this.nodeOut=e.ctx.createGain(),this.nodeIn.connect(this.nodeOut),this.connect(e)},walContext.Filters.prototype={connect:function(e){e=e.nodeIn||e,e instanceof AudioNode&&(this.connectedTo=e,this.nodeOut.connect(e))},disconnect:function(){this.nodeOut.disconnect(),this.connectedTo=null},empty:function(){this.nodes.length&&(this.nodes[this.nodes.length-1].disconnect(),this.nodeIn.disconnect(),this.nodeIn.connect(this.nodeOut),this.nodes=[])},gain:function(e){return arguments.length?void(this.nodeOut.gain.value=e):this.nodeOut.gain.value},pushBack:function(e){if(this.nodes.length){var t=this.nodes[this.nodes.length-1];t.disconnect(),t.connect(e)}else this.nodeIn.disconnect(),this.nodeIn.connect(e);e.connect(this.nodeOut),this.nodes.push(e)},pushFront:function(e){this.nodes.length?(this.nodeIn.disconnect(),this.nodeIn.connect(e),e.connect(this.nodes[0]),this.nodes.unshift(e)):this.pushBack(e)},popBack:function(){var e=this.nodes.pop();if(e)if(e.disconnect(),this.nodes.length){var t=this.nodes[this.nodes.length-1];t.disconnect(),t.connect(this.nodeOut)}else this.nodeIn.disconnect(),this.nodeIn.connect(this.nodeOut);return e},popFront:function(){var e=this.nodes.shift();return e&&(e.disconnect(),this.nodeIn.disconnect(),this.nodeIn.connect(this.nodes[0]||this.nodeOut)),e}},walContext.Sample=function(e){this.wCtx=e,this.connectedTo=e.nodeIn,this.loaded=this.started=this.playing=!1,this._onendedFn=function(){},this.onplay=this.onplay.bind(this),this.onended=this.onended.bind(this),this.edit(0,0)},walContext.Sample.prototype={setBuffer:function(e){return this.wBuffer=e,this.setBufferDuration(e.buffer.duration)},setBufferDuration:function(e){return this.bufferDuration=e,(null==this.duration||this.duration>e)&&(this.duration=e),this},edit:function(e,t,n){return null!=e&&(this.when=e),null!=t&&(this.offset=t),null!=n&&(this.duration=n),this},connect:function(e){return e=e.nodeIn||e,e instanceof AudioNode&&(this.connectedTo=e,this.source&&this.source.connect(e)),this},disconnect:function(){return this.source&&(this.source.disconnect(),this.connectedTo=null),this},load:function(){return this.wBuffer&&!this.loaded&&(this.loaded=!0,this.source=this.wCtx.ctx.createBufferSource(),this.source.buffer=this.wBuffer.buffer,this.source.onended=this.onended,this.connectedTo&&this.source.connect(this.connectedTo)),this},start:function(e,t,n){return this.loaded&&!this.started&&(e=null!=e?e:this.when,t=null!=t?t:this.offset,n=null!=n?n:this.duration,this.source.start(this.wCtx.ctx.currentTime+e,t,n),this.started=!0,e?this.playTimeoutId=setTimeout(this.onplay,1e3*e):this.onplay()),this},stop:function(){return this.started&&(this.source.onended=null,this.source.stop(0),this.onended()),this},onplay:function(){this.playing=!0,++this.wCtx.nbPlaying},onended:function(e){return"function"==typeof e?this._onendedFn=e:this.loaded&&(this.started&&(this.started=!1,clearTimeout(this.playTimeoutId)),this.playing&&(this.playing=!1,--this.wCtx.nbPlaying),this.loaded=!1,this.source=null,this._onendedFn()),this}},window.gs={sample:{},samples:{selected:{}},file:{},files:[],selectedSamples:[]},function(){var e,t,n;gs.loop=e={reorderTimeAB:function(){if(t>n){var e=t;t=n,n=e}},timeA:function(n){lg("timea"),t=n,e.update()},timeB:function(t){lg("timeb"),n=t,e.update()},stop:function(){t=n=void 0,ui.timelineLoop.toggle(!1)},update:function(){var e,i,s=Math.abs(n-t);isNaN(s)||(i=Math.min(t,n),e=s>.01,e&&(ui.timelineLoop.when(i),ui.timelineLoop.duration(s)),ui.timelineLoop.toggle(e))}}}(),gs.playStop=function(){(gs.isPlaying?gs.stop:gs.play)()},gs.playPause=function(){(wa.composition.isPlaying?gs.pause:gs.play)()},gs.play=function(){gs.file.stop(),!wa.composition.isPlaying&&wa.composition.samples.length&&(wa.composition.play(),wa.composition.isPlaying&&(gs.isPaused=!(gs.isPlaying=!0),ui.btnPlay.play()))},gs.pause=function(){gs.file.stop(),wa.composition.isPlaying&&(wa.composition.pause(),gs.isPaused=!(gs.isPlaying=!1),ui.btnPlay.pause());

},gs.stop=function(){gs.file.stop(),gs.compositionStop()},gs.compositionStop=function(){wa.composition.stop(),gs.currentTime(0),gs.isPaused=gs.isPlaying=!1,ui.btnStop.stop()},function(){gs.history={goToAction:function(e){var n=e.id-t+1;if(0>n)for(;n++;)gs.history.undo();else if(n>0)for(;n--;)gs.history.redo()},push:function(n,i){var s={id:t,name:n,fn:gs.history[n],data:i};t<e.length-1&&e.splice(t+1),e.push(s),ui.historyList.push(s),++t},undo:function(){if(t>0){var n=e[t--];n.fn&&n.fn(n.data,-1),ui.historyList.undo()}},redo:function(){if(t<e.length-1){var n=e[++t];n.fn&&n.fn(n.data,1),ui.historyList.redo()}}};var e=[{}],t=0}(),function(){function e(e){e.samples.forEach(function(e){gs.sample.select(e)})}function t(e,t){return-1===t?n(e,1):void e.samples.forEach(function(e){wa.composition.add(e),ui.sample.create(e),gs.sample.inTrack(e,e.data.oldTrack.id),gs.sample.when(e,e.when),gs.sample.duration(e,e.duration),gs.sample.slip(e,e.offset),gs.sample.select(e,e.data.oldSelected),e.data.gsfile.nbSamples++||ui.CSS_fileUsed(e.data.gsfile)})}function n(e,n){-1===n?t(e,1):e.samples.forEach(gs.sample["delete"])}function i(e,t){var n=e.sample,i=e.track*t;gs.samples.selected.when(n,e.when*t),i&&(n.data.selected?gs.selectedSamples.forEach(function(e){gs.sample.inTrack(e,e.data.track.id+i)}):gs.sample.inTrack(n,n.data.track.id+i)),gs.samples.selected["do"](n,function(e){wa.composition.update(e,"mv")})}function s(e,t){var n=e.sample;gs.samples.selected.duration(n,e.duration*t),gs.samples.selected.when(n,e.when*t),gs.samples.selected.slip(n,-e.offset*t),gs.samples.selected["do"](n,function(e){wa.composition.update(e,"mv")})}function a(e,t){gs.samples.selected.duration(e.sample,e.duration*t),gs.samples.selected["do"](e.sample,function(e){wa.composition.update(e,"mv")})}function o(e,t){gs.samples.selected.slip(e.sample,e.offset*t),gs.samples.selected["do"](e.sample,function(e){wa.composition.update(e,"mv")})}Object.assign(gs.history,{select:e,insert:t,"delete":n,move:i,crop:s,cropEnd:a,slip:o})}(),function(){var e=[],t="click mousedown mouseup mousemove".split(" ");window.ui={dom:{},initElement:function(t,n){return e.push({name:t,fn:n}),ui},init:function(n,i,s){function a(e){e.id&&(ui.dom[e.id]=e)}var o,r=Handlebars.templates;for(o in r)o!==i&&Handlebars.registerPartial(o,r[o]);n.innerHTML=r[i](s),function l(e){for(var t,n=e.firstChild;null!==n;)l(t=n),n=n.nextSibling,1!==t.nodeType&&/^\s*$/.test(t.textContent)&&e.removeChild(t)}(n),a(n),Array.from(n.querySelectorAll("[id]")).forEach(a),e.forEach(function(e){var n,i=ui.dom[e.name],s=e.fn(i);ui[e.name]=s;for(n in s)t.indexOf(n)>-1&&i.addEventListener(n,s[n])})}}}(),ui.isMagnetized=!1,ui.initElement("btnMagnet",function(e){function t(t){"boolean"!=typeof t&&(t=!ui.isMagnetized),ui.isMagnetized=t,e.classList.toggle("active",t)}return{click:t,toggle:t}}),ui.initElement("btnPlay",function(e){function t(){var e=wa.composition.currentTime();ui.currentTimeCursor.at(e),ui.clock.setTime(e),n=requestAnimationFrame(t)}var n;return{click:gs.playPause,play:function(){e.classList.remove("play"),e.classList.add("pause"),t()},pause:function(){cancelAnimationFrame(n),e.classList.remove("pause"),e.classList.add("play")}}}),ui.initElement("btnSave",function(e){return{click:function(){var t=gs.save();e.setAttribute("href",t.href),e.setAttribute("download",t.download)}}}),ui.initElement("btnStop",function(){return{click:gs.stop,stop:function(){ui.btnPlay.pause(),ui.currentTimeCursor.at(0),ui.clock.setTime(0)}}}),ui.initElement("btnUndo",function(){return{click:gs.history.undo}}),ui.initElement("btnRedo",function(){return{click:gs.history.redo}}),ui.initElement("clock",function(){return{setUnit:function(e){var t=gs.currentTime();ui.dom.clockUnits.dataset.unit=e,ui.currentTimeCursor.at(t),ui.clock.setTime(t)},setTime:function(e){var t,n,i;"s"===gs.clockUnit?(t=~~(e/60),n=~~(e%60)):(e*=ui.BPMem,t=1+~~e,e*=4,n=1+~~e%4),n=10>n?"0"+n:n,i=Math.floor(1e3*(e-~~e)),10>i?i="00"+i:100>i&&(i="0"+i),ui.dom.clockMin.textContent=t,ui.dom.clockSec.textContent=n,ui.dom.clockMs.textContent=i}}}),ui.initElement("currentTimeCursor",function(e){var t=ui.dom.currentTimeArrow;return{at:function(n){if(n>0){var i=n*ui.BPMem+"em";wisdom.css(e,"left",i),wisdom.css(t,"left",i)}e.classList.toggle("visible",n>0),t.classList.toggle("visible",n>0)}}}),ui.initElement("historyList",function(e){var t,n;return{click:function(e){(e=e.target.historyAction)&&gs.history.goToAction(e)},reset:function(){for(t=0,n=[];e.hasChildNodes();)e.lastChild.remove()},undo:function(){n[--t].classList.add("undone")},redo:function(){n[t++].classList.remove("undone")},push:function(i){for(var s=n.length-t,a=wisdom.cE(Handlebars.templates.historyAction(i))[0];s-->0;)n.pop().remove();t++,a.historyAction=i,n.push(a),e.appendChild(a),e.scrollTop=1e9}}}),ui.initElement("timeline",function(){var e;return{mousedown:function(t){var n=Date.now();250>n-e&&(gs.loop.stop(),gs.loop.timeA(ui.getGridSec(t.pageX)),ui.timelineLoop.clickTime("b")),e=n},mouseup:function(e){ui.timelineLoop.dragging||gs.currentTime(ui.getGridSec(e.pageX))},update:function(){var e=ui.trackLinesLeft/ui.gridEm,t=ui.trackLinesWidth/ui.gridEm;ui.timelineBeats.fill(Math.ceil(-e+t)),ui.dom.timelineBeats.style.marginLeft=e+="em",ui.dom.currentTimeArrow.style.marginLeft=e,ui.dom.timelineLoop.style.marginLeft=e}}}),ui.initElement("timelineBeats",function(e){var t=0;return{fill:function(n){if(n>t){var i=t;for(t=n;i++<n;)e.appendChild(wisdom.cE(Handlebars.templates.timelineBeat())[0])}}}}),ui.initElement("timelineLoop",function(e){var t,n;return document.body.addEventListener("mousemove",function(e){n&&n(ui.getGridSec(e.pageX))}),document.body.addEventListener("mouseup",function(){n&&(n=null,t.dragging=!1,ui.cursor("app",null))}),t={mousedown:function(e){var n=e.target;n.classList.contains("time")&&(t.clickTime(n.classList.contains("a")?"a":"b"),e.stopPropagation())},clickTime:function(e){n="a"===e?gs.loop.timeA:gs.loop.timeB,gs.loop.reorderTimeAB(),t.dragging=!0,ui.cursor("app","w-resize")},toggle:function(t){e.classList.toggle("hidden",!t)},when:function(t){e.style.left=t*ui.BPMem+"em"},duration:function(t){e.style.width=t*ui.BPMem+"em"}}}),ui.initElement("tracksBg",function(e){function t(t){var s,a,o,r,l,u=t-i;for(i=Math.max(t,i),s=0;u>s;++s){for(r=document.createElement("div"),a=0;4>a;++a){for(l=document.createElement("div"),o=0;4>o;++o)l.appendChild(document.createElement("div"));r.appendChild(l)}e.appendChild(r)}n=n||e.firstChild}var n,i=0;return{update:function(){t(Math.ceil(ui.trackLinesWidth/ui.gridEm/4)+2),wisdom.css(n,"marginLeft",ui.trackLinesLeft/ui.gridEm%8+"em")}}}),ui.initElement("visualCanvas",function(e){function t(){var a=i;wa.wctx.nbPlaying&&(a=wa.analyserArray,wa.analyser.getByteTimeDomainData(a)),wa.oscilloscope(e,s,a),n=requestAnimationFrame(t)}var n,i=[],s=e.getContext("2d");return{on:function(){n=requestAnimationFrame(t)},off:function(){cancelAnimationFrame(n),s.clearRect(0,0,e.width,e.height)}}}),ui.init(wisdom.qS("#app"),"_app",{}),ui.dom.toolBtns=wisdom.qSA(ui.dom.menu,".btn[data-tool]"),ui.tool={},ui.tracks=[],ui.nbTracksOn=0,ui.gridEm=parseFloat(getComputedStyle(ui.dom.grid).fontSize),ui.gridColsY=ui.dom.gridCols.getBoundingClientRect().top,ui.dom.visualCanvas.width=256,ui.dom.visualCanvas.height=ui.dom.visualCanvas.clientHeight,ui.bpm=function(e){var t=~~e,n=Math.min(Math.round(100*(e-t)),99);ui._bpm=e,ui.dom.bpmInt.textContent=100>t?"0"+t:t,ui.dom.bpmDec.textContent=10>n?"0"+n:n},function(){function e(e,t){t?e.dataset.cursor=t:e.removeAttribute("data-cursor")}var t=null;ui.cursor=function(n,i){"app"===n?(e(ui.dom.app,i),e(ui.dom.tracksLines,i?null:t)):e(ui.dom.tracksLines,t=i)}}(),function(){function e(e,t){return Math.abs(e-t)<1e-4}function t(e){var t=e%n;return e-=t,t>i&&(e+=n),e}ui.getGridSec=function(e){var n=(e-ui.filesWidth-ui.trackNamesWidth-ui.trackLinesLeft)/ui.gridEm;return(ui.isMagnetized?t(n):n)/ui.BPMem},ui.secFloor=function(i){var s=i*ui.BPMem,a=t(s);return(s>a||e(a,s)?a:a-n)/ui.BPMem},ui.secCeil=function(i){var s=i*ui.BPMem,a=t(s);return(a>s||e(a,s)?a:a+n)/ui.BPMem};var n=.25,i=n/2}(),ui.getTrackFromPageY=function(e){return ui.tracks[Math.floor((e-ui.gridColsY+ui.gridScrollTop)/ui.gridEm)]},ui.CSS_fileUnloaded=function(e){e.elIcon.classList.add("ramload"),e.elIcon.classList.remove("question"),e.elFile.classList.add("unloaded")},ui.CSS_fileWithoutData=function(e){e.elIcon.classList.add("question"),e.elIcon.classList.remove("ramload"),e.elFile.classList.add("unloaded")},ui.CSS_fileLoading=function(e){e.elIcon.classList.add("loading"),e.elIcon.classList.remove("ramload")},ui.CSS_fileLoaded=function(e){e.elFile.classList.add("loaded"),e.elFile.classList.remove("unloaded"),e.elIcon.remove()},ui.CSS_fileError=function(e){e.elIcon.classList.add("cross"),e.elIcon.classList.remove("loading")},ui.CSS_fileUsed=function(e){e.elFile.classList.add("used")},ui.CSS_fileUnused=function(e){e.elFile.classList.remove("used")},ui.newTrack=function(){ui.tracks.push(new ui.Track(this))},ui.panelSection=function(e){ui.dom.app.dataset.panel=e},ui.resize=function(){ui.screenWidth=document.body.clientWidth,ui.screenHeight=document.body.clientHeight,ui.gridColsWidth=ui.dom.gridCols.getBoundingClientRect().width,ui.gridColsHeight=ui.dom.tracks.clientHeight,ui.trackLinesWidth=ui.gridColsWidth-ui.trackNamesWidth,ui.timeline.update(),ui.tracksBg.update()},ui.sample={create:function(e){var t=wisdom.cE(Handlebars.templates.sample(e.data.gsfile))[0];e.data.elSample=t,e.data.elSVG=wisdom.qS(t,"svg"),e.data.elName=wisdom.qS(t,".name"),e.data.elCropStart=wisdom.qS(t,".crop.start"),e.data.elCropEnd=wisdom.qS(t,".crop.end"),wisdom.qSA(t,"*").forEach(function(t){t.gsSample=e})},"delete":function(e){e.data.elSample.remove()},select:function(e){e.data.elSample.classList.toggle("selected",e.data.selected)},inTrack:function(e){e.data.track.elColLinesTrack.appendChild(e.data.elSample)},when:function(e){wisdom.css(e.data.elSample,"left",e.when*ui.BPMem+"em")},duration:function(e){wisdom.css(e.data.elSample,"width",e.duration*ui.BPMem+"em"),ui.sample.waveform(e)},waveform:function(e){if(e.wBuffer){var t=e.offset,n=Math.min(e.duration,e.bufferDuration-t),i=e.connectedTo.gain.value,s=n*ui.BPMem;wisdom.css(e.data.elSVG,"width",s+"em"),e.wBuffer.waveformSVG(e.data.elSVG,~~(50*s),50,t,n,i)}}},ui.selectTool=function(){var e;return function(t){var n,i=ui.dom.toolBtns.tool[t];i!==e&&(e&&(e.classList.remove("active"),n=ui.tool[ui.currentTool],n.mouseup&&n.mouseup({}),n.end&&n.end()),e=i,i.classList.add("active"),ui.dom.grid.dataset.tool=ui.currentTool=t,n=ui.tool[t],n.start&&n.start())}}(),ui.setFilesWidth=function(e){wisdom.css(ui.dom.panel,"width",e+"px"),ui.filesWidth=e=ui.dom.panel.clientWidth,ui.gridColsWidth=ui.screenWidth-e,ui.trackLinesWidth=ui.gridColsWidth-ui.trackNamesWidth,wisdom.css(ui.dom.grid,"left",e+"px"),wisdom.css(ui.dom.visual,"width",e+ui.trackNamesWidth+"px"),wisdom.css(ui.dom.menu,"left",e+ui.trackNamesWidth+"px"),ui.timeline.update(),ui.tracksBg.update()},ui.gridScrollTop=0,ui.setGridScrollTop=function(e){ui.dom.gridCols.scrollTop=ui.gridScrollTop=0>=e?0:Math.min(e,ui.tracks.length*ui.gridEm-ui.gridColsHeight),ui.updateGridTopShadow()},ui.gridZoom=1,ui.setGridZoom=function(e,t,n){e=Math.min(Math.max(1,e),8);var i=e/ui.gridZoom;ui.gridZoom=e,ui.gridEm*=i,wisdom.css(ui.dom.gridEm,"fontSize",e+"em"),ui.dom.grid.dataset.sampleSize=ui.gridEm<40?"small":ui.gridEm<80?"medium":"big",ui.setGridScrollTop(-(n-(ui.gridScrollTop+n)*i)),ui.setTrackLinesLeft(t-(-ui.trackLinesLeft+t)*i),ui.timeline.update(),ui.tracksBg.update()},ui.setTrackLinesLeft=function(e){ui.trackLinesLeft=e=Math.min(~~e,0),wisdom.css(ui.dom.tracksLines,"marginLeft",e/ui.gridEm+"em"),ui.updateGridLeftShadow()},ui.trackNamesWidth=0,ui.setTrackNamesWidth=function(e){var t,n=ui.trackNamesWidth;wisdom.css(ui.dom.tracksNames,"width",e+"px"),ui.trackNamesWidth=e=ui.dom.tracksNames.getBoundingClientRect().width,ui.trackLinesWidth=ui.gridColsWidth-e,t=ui.filesWidth+e,wisdom.css(ui.dom.gridColB,"left",e+"px"),wisdom.css(ui.dom.timeline,"left",e+"px"),wisdom.css(ui.dom.visual,"width",t+"px"),wisdom.css(ui.dom.menu,"left",t+"px"),ui.trackLinesLeft<0&&ui.setTrackLinesLeft(ui.trackLinesLeft-(e-n)),ui.timeline.update(),ui.tracksBg.update()},ui.toggleTracks=function(e){for(var t,n=0,i=e.isOn&&1===ui.nbTracksOn;t=ui.tracks[n++];)t.toggle(i);e.toggle(!0)},function(){var e=2,t="rgba(0,0,0,.3)",n="px "+e+"px "+t;ui.updateGridLeftShadow=function(){var e=-ui.trackLinesLeft;wisdom.css(ui.dom.tracksNames,"boxShadow",e?Math.min(2+e/8,5)+"px 0"+n:"none")},ui.updateGridTopShadow=function(){var e=ui.gridScrollTop;wisdom.css(ui.dom.gridHeader,"boxShadow",e?"0px "+Math.min(2+e/8,5)+n:"none")}}(),ui.Track=function(e,t){t=t||{},this.grid=e,this.id=ui.tracks.length,this.elColNamesTrack=wisdom.cE("<div class='track'>")[0],this.elColLinesTrack=wisdom.cE("<div class='track'>")[0],ui.dom.tracksNames.appendChild(this.elColNamesTrack),ui.dom.tracksLines.appendChild(this.elColLinesTrack),this.elColNamesTrack.uitrack,this.elColLinesTrack.uitrack=this,this.wfilters=wa.wctx.createFilters(),this.samples=[],this.initToggle().initEditName().toggle(t.toggle!==!1).editName(t.name||"")},ui.Track.prototype={removeSample:function(e){var t=this.samples.indexOf(e);t>=0&&this.samples.splice(t,1)}},ui.Track.prototype.initEditName=function(){var e=this;return this.elName=wisdom.cE("<span class='name text-overflow'>")[0],this.elName.ondblclick=this.editName.bind(this,!0),this.elColNamesTrack.appendChild(this.elName),this.elNameInput=wisdom.cE("<input type='text'/>")[0],this.elColNamesTrack.appendChild(this.elNameInput),this.elNameInput.onblur=function(){e.editName(this.value).editName(!1)},this.elNameInput.onkeydown=function(t){(13===t.keyCode||27===t.keyCode)&&e.editName(13===t.keyCode?this.value:e.name).editName(!1),t.stopPropagation()},this},ui.Track.prototype.editName=function(e){var t=this.elNameInput,n="Track "+(this.id+1);return"string"==typeof e?(e=e.replace(/^\s+|\s+$/,"").replace(/\s+/g," "),e=e===n?"":e,this.elName.classList.toggle("empty",""===e),this.elName.textContent=e||n,this.name=e):e?(this.elColNamesTrack.classList.add("editing"),t.value=this.name||n,t.focus(),t.select()):(t.blur(),this.elColNamesTrack.classList.remove("editing")),this},ui.Track.prototype.initToggle=function(){var e=this;return this.elToggle=wisdom.cE("<a class='toggle icon circle'>")[0],this.elColNamesTrack.appendChild(this.elToggle),this.elToggle.oncontextmenu=function(){return!1},this.elToggle.onmousedown=function(t){0===t.button?e.toggle():2===t.button&&ui.toggleTracks(e)},this},ui.Track.prototype.toggle=function(e){return"boolean"!=typeof e&&(e=!this.isOn),this.isOn!==e&&(this.wfilters.gain(+e),this.isOn=e,this.grid.nbTracksOn+=e?1:-1,this.elToggle.classList.toggle("on",e),this.elColNamesTrack.classList.toggle("off",!e),this.elColLinesTrack.classList.toggle("off",!e)),this},function(){var e=new walContext,t=e.ctx.createAnalyser();t.fftSize=256,e.filters.pushBack(t),window.wa={wctx:e,ctx:e.ctx,analyser:t,analyserArray:new Uint8Array(t.frequencyBinCount),composition:e.createComposition()}}(),wa.oscilloscope=function(){var e=0,t=Math.PI/2;return function(n,i,s){var a,o=0,r=n.width,l=n.height,u=s.length,c=u/2,d=r/(u-1);for(i.globalCompositeOperation="source-in",i.fillStyle="rgba("+Math.round(255-255*e)+","+Math.round(64*e)+","+Math.round(255*e)+","+(.95-.25*(1-Math.cos(e*t)))+")",i.fillRect(0,0,r,l),e=0,i.globalCompositeOperation="source-over",i.save(),i.translate(0,l/2),i.beginPath(),i.moveTo(0,0);u>o;++o)a=(s[o]-128)/128,e=Math.max(Math.abs(a),e),a*=.5-Math.cos((c>o?o:u-o)/c*Math.PI)/2,i.lineTo(o*d,a*l);i.lineJoin="round",i.lineWidth=1+Math.round(2*e),i.strokeStyle="rgba(255,255,255,"+Math.min(.3+4*e,1)+")",i.stroke(),i.restore()}}(),ui.BPMem=1,gs.bpm=function(e){if(!arguments.length)return gs._bpm;var t,n=ui.BPMem,i=gs.currentTime()*n;gs._bpm=Math.max(20,Math.min(e,999)),ui.bpm(gs._bpm),ui.BPMem=e/60,t=n/ui.BPMem,wa.composition.samples.forEach(function(e){e.when=e.when*t,ui.sample.duration(e)}),gs.currentTime(i/ui.BPMem)},gs.currentTime=function(e){return arguments.length?(wa.composition.currentTime(e),e=wa.composition.currentTime(),ui.currentTimeCursor.at(e),void ui.clock.setTime(e)):wa.composition.currentTime()},function(){function e(e,t){var n=JSON.parse(t.target.result);gs.bpm(n.bpm),n.files.forEach(gs.file.create),n.tracks.forEach(function(e){for(var t=e[0];t>=ui.tracks.length;)ui.newTrack();ui.tracks[t].toggle(e[1]).editName(e[2])}),n.samples.forEach(function(e){var t=gs.sample.create(gs.files[e[1]]);t.data.gsfile.samplesToSet.push(t),gs.sample.inTrack(t,e[0]),gs.sample.when(t,e[2]/ui.BPMem),gs.sample.slip(t,e[3]/ui.BPMem),gs.sample.duration(t,e[4]/ui.BPMem),wa.composition.update(t,"ad")}),e()}gs.load=function(t){return new Promise(function(n){if(t){var i=new FileReader;i.onload=e.bind(null,n),i.readAsText(t)}else n()})}}(),function(){function e(e){var t=e.length-1;return e.reduce(function(e,n,i){return e+"		"+JSON.stringify(n)+(t>i?",":"")+"\n"},"")}gs.save=function(){var t=gs.files.map(function(e){return[e.id,e.fullname,e.file?e.file.size:e.size,e.wbuff?e.wbuff.buffer.duration:e.bufferDuration]}),n=wa.composition.samples.map(function(e){return[e.data.track.id,e.data.gsfile.id,ui.BPMem*e.when,ui.BPMem*e.offset,ui.BPMem*e.duration]}),i=ui.tracks.reduce(function(e,t){return(!t.isOn||t.samples.length||t.name||t.wfilters&&t.wfilters.length)&&e.push([t.id,t.isOn,t.name]),e},[]);return{download:"gridsound-composition.gs",href:"data:text/plain;charset=utf-8,"+encodeURIComponent('{\n	"saveformat": 2,\n	"bpm": '+gs._bpm+',\n	"files": [\n'+e(t)+'	],\n	"tracks": [\n'+e(i)+'	],\n	"samples": [\n'+e(n)+"	]\n}")}}}(),gs.reset=function(){return ui.tracks.forEach(function(e){e.editName(""),e.toggle(!0)}),wa.composition.samples.forEach(function(e){gs.sample.select(e,!0)}),gs.samples.selected["delete"](),gs.files.forEach(function(e){e.elFile.remove()}),gs.files=[],this},function(){var e;ui.dom.filesInput.onchange=function(){e&&(gs.file.joinFile(e,this.files[0]),e=null)},gs.file.create=function(t){var n={id:gs.files.length,isLoaded:!1,isLoading:!1,nbSamples:0,samplesToSet:[],file:t.length?null:t,bufferDuration:t.length?t[3]:null,fullname:t.name||t[1]};return n.name=n.fullname.replace(/\.[^.]+$/,""),n.elFile=wisdom.cE(Handlebars.templates.file(n))[0],n.elName=wisdom.qS(n.elFile,".name"),n.elIcon=wisdom.qS(n.elFile,".icon"),n.file?ui.CSS_fileUnloaded(n):(n.size=t[2],ui.CSS_fileWithoutData(n)),n.elFile.oncontextmenu=function(){return!1},n.elFile.ondragstart=gs.file.dragstart.bind(null,n),n.elFile.onmousedown=function(e){0!==e.button&&gs.file.stop(),e.ctrlKey&&gs.file["delete"](n)},n.elFile.onclick=function(){n.isLoaded?gs.file.play(n):n.file?n.isLoading||gs.file.load(n,gs.file.play):(alert("Choose the file to associate or drag and drop "+n.name),e=n,ui.dom.filesInput.click())},gs.files.push(n),ui.dom.filesList.appendChild(n.elFile),n}}(),gs.file["delete"]=function(e){wa.composition.samples.filter(function(t){return t.data.gsfile===e}).forEach(function(e){gs.sample["delete"](e)}),gs.files.splice(gs.files.indexOf(e),1),e.elFile.remove()},function(){document.body.addEventListener("mousemove",function(n){e&&(wisdom.css(t,"left",n.pageX+"px"),wisdom.css(t,"top",n.pageY+"px"))}),document.body.addEventListener("mouseup",function(){e&&(t.remove(),e=null,ui.cursor("app",null))}),ui.dom.gridColB.addEventListener("mouseup",function(t){if(e){var n=gs.sample.create(e);gs.sample.inTrack(n,ui.getTrackFromPageY(t.pageY).id),gs.sample.when(n,ui.getGridSec(t.pageX)),wa.composition.update(n,"ad")}}),gs.file.dragstart=function(n,i){return n.isLoaded&&!e&&(e=n,t=n.elSVG.cloneNode(!0),wisdom.css(t,"left",i.pageX+"px"),wisdom.css(t,"top",i.pageY+"px"),t.classList.add("dragging"),document.body.appendChild(t),ui.cursor("app","grabbing")),!1};var e,t}(),gs.file.joinFile=function(e,t){e.file=t,ui.CSS_fileUnloaded(e),e.fullname!==t.name&&(e.fullname=t.name,e.name=e.fullname.replace(/\.[^.]+$/,""),e.elName.textContent=e.name),e.samplesToSet.length&&gs.file.load(e,function(e){e.samplesToSet.forEach(function(t){t.setBuffer(e.wbuff),t.data.elName.textContent=e.name,ui.sample.duration(t)})})},gs.file.load=function(e,t){e.isLoading=!0,ui.CSS_fileLoading(e),wa.wctx.createBuffer(e.file).then(function(n){e.wbuff=n,e.isLoaded=!0,e.isLoading=!1,e.elSVG=wisdom.qS(e.elFile,"svg"),e.elWaveformWrap=e.elSVG.parentNode,n.waveformSVG(e.elSVG,400,50),ui.CSS_fileLoaded(e),t(e)},function(){e.isLoading=!1,ui.CSS_fileError(e),alert('At this day, the file: "'+e.fullname+'" can not be decoded by your browser.\n')})},function(){gs.file.play=function(n){e&&e.stop(),n.isLoaded&&(wisdom.css(t,"transitionDuration",0),wisdom.css(t,"left",0),n.elWaveformWrap.appendChild(t),e=wa.wctx.createSample().setBuffer(n.wbuff).onended(gs.file.stop).load().start(),setTimeout(function(){wisdom.css(t,"transitionDuration",n.wbuff.buffer.duration+"s"),wisdom.css(t,"left","100%")},20))},gs.file.stop=function(){e&&(e.stop(),t.remove())};var e,t=wisdom.cE("<div class='cursor'>")[0]}(),gs.sample.create=function(e){var t=wa.wctx.createSample();return e.file?t.setBuffer(e.wbuff):t.setBufferDuration(e.bufferDuration),t.data={selected:!1,gsfile:e},++e.nbSamples,wa.composition.add(t),ui.CSS_fileUsed(e),ui.sample.create(t),ui.sample.duration(t),ui.sample.select(t),t},gs.sample.cut=function(e,t){if(t<e.duration){var n=gs.sample.create(e.data.gsfile);gs.sample.inTrack(n,e.data.track.id),gs.sample.when(n,e.when+t),gs.sample.slip(n,e.offset+t),gs.sample.duration(n,e.duration-t),gs.sample.duration(e,t),wa.composition.update(e,"mv"),wa.composition.update(n,"ad")}},gs.sample["delete"]=function(e){if(e){var t=e.data;t.oldSelected=!!t.selected,gs.sample.select(e,!1),--t.gsfile.nbSamples||ui.CSS_fileUnused(t.gsfile),e.stop(),t.track.removeSample(e),t.oldTrack=t.track,e.data.track=void 0,wa.composition.remove(e),ui.sample["delete"](e)}},gs.sample.duration=function(e,t){e.duration=Math.max(0,Math.min(t,e.bufferDuration)),ui.sample.duration(e)},gs.sample.inTrack=function(e,t){var n=e.data,i=ui.tracks[t];i!==n.track&&(e.disconnect(),e.connect(i.wfilters),n.track&&n.track.removeSample(e),n.track=i,i.samples.push(e),ui.sample.inTrack(e))},gs.sample.mute=function(){lg("sample muted (in development)")},gs.sample.select=function(e,t){e&&e.data.selected!==t&&("boolean"!=typeof t&&(t=!e.data.selected),t?gs.selectedSamples.push(e):gs.selectedSamples.splice(gs.selectedSamples.indexOf(e),1),e.data.selected=t,ui.sample.select(e))},gs.sample.slip=function(e,t){e.offset=Math.min(e.bufferDuration,Math.max(t,0)),ui.sample.waveform(e)},gs.sample.gain=function(e,t){e.connectedTo.gain.value+=t,e.connectedTo.gain.value<0&&(e.connectedTo.gain.value=0),ui.sample.waveform(e)},gs.sample.when=function(e,t){e.when=t,ui.sample.when(e)},gs.samples.selected["do"]=function(e,t){e&&(e.data.selected?gs.selectedSamples.forEach(t):t(e))},gs.samples.selected.min=function(e,t){return e.data.selected?gs.selectedSamples.reduce(function(e,n){return Math.min(e,t(n))},1/0):t(e)},gs.samples.selected.max=function(e,t){return e.data.selected?gs.selectedSamples.reduce(function(e,n){return Math.max(e,t(n))},-(1/0)):t(e)},function(){gs.samples.selected.copy=function(){var n=1/0,i=-(1/0);t=gs.selectedSamples.map(function(e){return n=Math.min(n,e.when),i=Math.max(i,e.when+e.duration),e}),ui.isMagnetized&&(n=ui.secFloor(n),i=ui.secCeil(i)),e=i-n},gs.samples.selected.paste=function(){gs.samples.selected.unselect(),t.forEach(function(t){var n=gs.sample.create(t.data.gsfile);gs.sample.inTrack(n,t.data.track.id),gs.sample.when(n,t.when+e),gs.sample.slip(n,t.offset),gs.sample.duration(n,t.duration),gs.sample.select(n,!0),wa.composition.update(n,"ad")}),gs.samples.selected.copy()};var e,t=[]}(),gs.samples.selected.cut=function(e,t){t-=e.when,gs.samples.selected["do"](e,function(e){gs.sample.cut(e,t)})},gs.samples.selected["delete"]=function(e){e&&(e.data?gs.sample["delete"](e):(gs.selectedSamples.slice(0).forEach(gs.sample["delete"]),gs.selectedSamples=[]))},gs.samples.selected.duration=function(e,t){return t=0>t?-Math.min(-t,gs.samples.selected.min(e,function(e){return e.duration})):Math.min(t,gs.samples.selected.min(e,function(e){return e.bufferDuration-e.duration})),gs.samples.selected["do"](e,function(e){gs.sample.duration(e,e.duration+t)}),t},gs.samples.selected.when=function(e,t){return 0>t&&(t=-Math.min(-t,gs.samples.selected.min(e,function(e){return e.when}))),gs.samples.selected["do"](e,function(e){gs.sample.when(e,Math.max(0,e.when+t))}),t},gs.samples.selected.slip=function(e,t){return t=0>t?-Math.min(-t,gs.samples.selected.min(e,function(e){return e.bufferDuration-e.offset})):Math.min(t,gs.samples.selected.min(e,function(e){return e.offset})),gs.samples.selected["do"](e,function(e){gs.sample.slip(e,e.offset-t)}),t},gs.samples.selected.gain=function(e,t){return gs.samples.selected["do"](e,function(e){gs.sample.gain(e,t)}),t},gs.samples.selected.cropEnd=gs.samples.selected.duration,gs.samples.selected.cropStart=function(e,t){return t=-gs.samples.selected.duration(e,-t),t&&(gs.samples.selected.when(e,t),gs.samples.selected.slip(e,-t)),t},gs.samples.selected.unselect=function(){gs.selectedSamples.forEach(function(e){e.data.selected=!1,ui.sample.select(e)}),gs.selectedSamples=[]},function(){function e(e,n){n=n.deltaY,ui.bpm(ui._bpm+(n>0?-e:n?e:0)),clearTimeout(t),t=setTimeout(gs.bpm.bind(null,ui._bpm),400)}ui.dom.bpmInt.onwheel=e.bind(null,1),ui.dom.bpmDec.onwheel=e.bind(null,.01),ui.dom.bpm.onmousedown=function(e){ui.dom.bpm.classList.toggle("clicked"),e.stopPropagation()},ui.dom.bpmList.onmousedown=function(e){var t=+e.target.textContent;return t&&gs.bpm(t),!1},document.body.addEventListener("mousedown",function(){ui.dom.bpm.classList.remove("clicked")});var t}(),ui.dom.clockUnits.onclick=function(e){var t=e.target.className;return("s"===t||"b"===t)&&ui.clock.setUnit(gs.clockUnit=t),!1},function(){var e,t=!1,n={panel:function(e){var t=e.pageX;ui.setFilesWidth(35>t?0:t)},trackNames:function(e){var t=e.pageX-ui.dom.grid.getBoundingClientRect().left;ui.setTrackNamesWidth(35>t?0:t)}};wisdom.qSA(".extend").forEach(function(i){i.onmousedown=function(i){0===i.button&&(t=!0,ui.cursor("app","col-resize"),e=n[this.dataset.mousemoveFn])}}),document.body.addEventListener("mouseup",function(e){0===e.button&&t&&(t=!1,ui.cursor("app",null))}),document.body.addEventListener("mousemove",function(n){t&&e(n)})}(),function(){function e(){a.forEach(function(e){gs.files.some(function(t){var n=t.file?t.file.size:t.size;return t.fullname===e.name&&n===e.size?(t.file||gs.file.joinFile(t,e),!0):void 0})||gs.file.create(e)})}function t(t){for(var a,o=0,r=[];a=t[o++];)a.webkitGetAsEntry&&(a=a.webkitGetAsEntry())?r.push(n(a)):(a=a.getAsFile())&&(lg("item.getAsFile()",a),i(a));Promise.all(r).then(function(){gs.load(s).then(function(){e()})})}function n(e){return new Promise(function(t){if(e.isFile)e.file(function(e){i(e),t()});else if(e.isDirectory){var s=e.createReader();s.readEntries(function(e){var i=[];e.forEach(function(e){i.push(n(e))}),Promise.all(i).then(t)})}else t()})}function i(e){switch(/[^.]*.?([^.]*)$/.exec(e.name)[1].toLowerCase()){case"gs":s=e,gs.reset();break;case"mp3":case"mpg":case"mpeg":case"wav":case"wave":case"ogg":a.push(e)}}var s,a;document.body.ondragover=function(){return!1},document.body.ondrop=function(n){var o,r=0,l=n&&n.dataTransfer;if(a=[],s=!1,l.items&&l.items.length)t(l.items);else{for(;o=l.files[r++];)i(o);gs.load(s).then(function(){e()})}return!1}}(),function(){function e(e){return i.every(function(t){return t===e||!n.contains(t)})}function t(e){n.toggle("used",e),n.toggle("loaded",e),n.toggle("unloaded",e)}ui.dom.filesFilters.onclick=ui.dom.filesFilters.oncontextmenu=function(){return!1},ui.dom.filesFilters.onmouseup=function(i){var s,a=i.target;"A"===a.nodeName&&(0===i.button?n.toggle(a.className):2===i.button&&(s=n.contains(a.className)&&e(a.className),t(s),s||n.add(a.className)))};var n=ui.dom.filesFilters.classList,i=["used","loaded","unloaded"];t(!0)}(),function(){function e(){i&&(ui.selectTool(i),i=null),t=!1}ui.px_x=ui.px_y=ui.px_xRel=ui.px_yRel=0,window.addEventListener("blur",e),ui.dom.gridCols.onwheel=function(e){return"zoom"===ui.currentTool?(ui.tool.zoom.wheel(e),!1):void 0},ui.dom.gridCols.onscroll=function(){ui.gridScrollTop=ui.dom.gridCols.scrollTop,ui.updateGridTopShadow()},ui.dom.tracksLines.oncontextmenu=function(){return!1},ui.dom.tracksLines.onmousedown=function(e){if(!t){t=!0,n=ui.getGridSec(e.pageX),ui.px_x=e.pageX,ui.px_y=e.pageY,2===e.button&&(i=ui.currentTool,ui.selectTool("delete"));var s=ui.tool[ui.currentTool].mousedown;s&&s(e)}},document.body.onwheel=function(e){return e.ctrlKey?!1:void 0},document.body.addEventListener("mousemove",function(e){if(t){var i=ui.tool[ui.currentTool].mousemove,s=ui.getGridSec(e.pageX);ui.px_xRel=e.pageX-ui.px_x,ui.px_yRel=e.pageY-ui.px_y,ui.px_x=e.pageX,ui.px_y=e.pageY,i&&(n+=i(e,s-n))}}),document.body.addEventListener("mouseup",function(n){if(t){var i=ui.tool[ui.currentTool].mouseup;i&&i(n),e()}});var t,n,i}(),function(){function e(e){n=ui.currentTool,ui.selectTool(e.name)}function t(t,i){"keydown"===i.type?e(t):n&&(ui.selectTool(n),n=null)}keyboardRouter({fn:t,when:"down,up",keys:["alt"],name:"hand"},{fn:t,when:"down,up",keys:["ctrl"],name:"zoom"},{fn:t,when:"down,up",keys:["shift"],name:"select"},{fn:e,keys:["z"],name:"zoom"},{fn:e,keys:["s"],name:"slip"},{fn:e,keys:["d"],name:"delete"},{fn:e,keys:["c"],name:"cut"},{fn:e,keys:["v"],name:"select"},{fn:e,keys:["g"],name:"gain"},{fn:e,keys:["b"],name:"paint"},{fn:e,keys:["h"],name:"hand"},{fn:gs.playStop,keys:[" "]},{fn:gs.playPause,keys:["ctrl"," "]},{fn:gs.samples.selected["delete"],keys:["delete"]},{fn:ui.btnMagnet.toggle,keys:["g"]},{fn:gs.samples.selected.copy,keys:["ctrl","c"]},{fn:gs.samples.selected.paste,keys:["ctrl","v"]},{fn:gs.history.undo,keys:["ctrl","z"]},{fn:gs.history.redo,keys:["ctrl","shift","z"]});var n}(),ui.dom.btnFiles.onclick=ui.panelSection.bind(null,"files"),ui.dom.btnHistory.onclick=ui.panelSection.bind(null,"history"),window.onresize=ui.resize(),ui.dom.toolBtns.tool={},ui.dom.toolBtns.forEach(function(e){ui.dom.toolBtns.tool[e.dataset.tool]=e,e.onclick=ui.selectTool.bind(null,e.dataset.tool)}),function(){ui.tool.cut={mousedown:function(t){e=t.target.gsSample},mouseup:function(t){e&&gs.samples.selected.cut(e,ui.getGridSec(t.pageX)),e=null}};var e}(),function(){function e(e){var t=e.target.gsSample;t&&(gs.history.push("delete",{samples:[t]}),gs.samples.selected["delete"](t))}ui.tool["delete"]={mousedown:e,mousemove:e}}(),ui.tool.hand={start:function(){ui.cursor("grid","grab")},end:function(){ui.cursor("grid",null)},mousedown:function(){ui.cursor("app","grabbing")},mouseup:function(){ui.cursor("app",null)},mousemove:function(){ui.setTrackLinesLeft(ui.trackLinesLeft+ui.px_xRel),ui.setGridScrollTop(ui.gridScrollTop-ui.px_yRel),ui.timeline.update(),ui.tracksBg.update()}},ui.tool.mute={},function(){ui.tool.paint={mousedown:function(l){var u=l.target.gsSample;!u&&gs.selectedSamples.length?(gs.history.push("select",{samples:gs.selectedSamples.slice()}),gs.samples.selected.unselect()):u&&(t=u.data.track.id,n=u.when,i=u.offset,s=u.duration,o=l.target.classList.contains("start"),a=o||l.target.classList.contains("end"),a?(r=o?"crop":"cropEnd",u.data[o?"elCropStart":"elCropEnd"].classList.add("hover")):r="move",e=u,ui.cursor("app",a?o?"w-resize":"e-resize":"grabbing"))},mouseup:function(){e&&(gs.samples.selected["do"](e,function(e){wa.composition.update(e,"mv")}),a&&(e.data[o?"elCropStart":"elCropEnd"].classList.remove("hover"),a=o=!1),(e.data.track.id!==t||e.when!==n||e.offset!==i||e.duration!==s)&&gs.history.push(r,{sample:e,track:e.data.track.id-t,when:e.when-n,offset:e.offset-i,duration:e.duration-s}),e=t=n=i=s=null,ui.cursor("app",null))},mousemove:function(t,n){if(e){if(!a){t=t.target;var i,s=1/0,r=t.uitrack||t.gsSample&&t.gsSample.data.track;r&&(e.data.selected?(i=r.id-e.data.track.id,0>i&&(gs.selectedSamples.forEach(function(e){s=Math.min(e.data.track.id,s)}),i=-Math.min(s,-i)),gs.selectedSamples.forEach(function(e){
gs.sample.inTrack(e,e.data.track.id+i)})):gs.sample.inTrack(e,r.id))}return a?o?gs.samples.selected.cropStart(e,n):gs.samples.selected.cropEnd(e,n):gs.samples.selected.when(e,n)}}};var e,t,n,i,s,a,o,r}(),function(){ui.tool.select={mousedown:function(n){var i=n.target.gsSample;o=[],n.shiftKey?i&&(o.push(i),gs.sample.select(i)):(gs.selectedSamples.forEach(function(e){e!==i&&o.push(e)}),gs.samples.selected.unselect(),gs.sample.select(i,!0)),e=n.pageX,t=n.pageY,s=!0},mouseup:function(){o&&o.length&&(gs.history.push("select",{samples:o}),o=null),s=a=!1,wisdom.css(l,"width","0px"),wisdom.css(l,"height","0px"),l.remove()},mousemove:function(u){if(s){var c=u.pageX,d=u.pageY;if(!a&&Math.max(Math.abs(c-e),Math.abs(d-t))>5&&(++r,a=!0,n=ui.getTrackFromPageY(t).id,i=ui.getGridSec(e),ui.dom.tracksLines.appendChild(l)),a){var f=ui.getTrackFromPageY(d),m=f?f.id:0,p=Math.min(n,m),h=Math.max(n,m),g=Math.max(0,ui.getGridSec(c)),v=Math.min(i,g),w=Math.max(i,g);wa.composition.samples.forEach(function(e){if(p<=e.data.track.id&&e.data.track.id<=h){var t=e.when,n=e.duration+t;if(t>=v&&w>t||n>v&&w>=n||v>=t&&n>=w)return void(e.data.selected||(e.data.squareSelected=r,gs.sample.select(e,!0),o.push(e)))}e.data.squareSelected===r&&(delete e.data.squareSelected,gs.sample.select(e,!1),o.splice(o.indexOf(e),1))}),wisdom.css(l,"top",p+"em"),wisdom.css(l,"left",v*ui.BPMem+"em"),wisdom.css(l,"width",(w-v)*ui.BPMem+"em"),wisdom.css(l,"height",h-p+1+"em")}}}};var e,t,n,i,s,a,o,r=0,l=wisdom.cE("<div id='squareSelection'>")[0]}(),function(){ui.tool.slip={mousedown:function(n){e=n.target.gsSample,e&&(t=e.offset)},mouseup:function(){e&&(gs.history.push("slip",{sample:e,offset:t-e.offset}),gs.samples.selected["do"](e,function(e){wa.composition.update(e,"mv")})),e=null},mousemove:function(t,n){return e?gs.samples.selected.slip(e,n):void 0}};var e,t}(),function(){ui.tool.gain={mousedown:function(n){e=n.target.gsSample,e&&(t=e.offset)},mouseup:function(){e=null},mousemove:function(t,n){return e?gs.samples.selected.gain(e,n):void 0}};var e,t}(),function(){function e(e,t){ui.setGridZoom(ui.gridZoom*t,e.pageX-ui.filesWidth-ui.trackNamesWidth,e.pageY-ui.gridColsY)}ui.tool.zoom={start:function(){ui.cursor("grid","zoom-in")},end:function(){ui.cursor("grid",null)},keydown:function(e){18===e.keyCode&&ui.cursor("grid","zoom-out")},keyup:function(e){18===e.keyCode&&ui.cursor("grid","zoom-in")},wheel:function(t){e(t,t.deltaY<0?1.1:.9)},mousedown:function(t){0===t.button&&e(t,t.altKey?.7:1.3)}}}(),function(){ui.resize(),ui.setFilesWidth(200),ui.setTrackLinesLeft(0),ui.setTrackNamesWidth(125),ui.setGridZoom(1.5,0,0),ui.visualCanvas.on(),ui.btnMagnet.toggle(!0),ui.tracksBg.update(),ui.historyList.reset(),ui.timelineLoop.toggle(!1),gs.bpm(120),gs.currentTime(0),wa.composition.onended(gs.compositionStop),ui.dom.btnFiles.click(),wisdom.qS(ui.dom.clockUnits,".s").click(),wisdom.qS(ui.dom.menu,"[data-tool='paint']").click();for(var e=0;42>e;++e)ui.newTrack()}();